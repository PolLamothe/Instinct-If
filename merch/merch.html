<link href="./css/merch.css" rel="stylesheet" type="text/css">
<div class="home_search">
    <div class="search__wrapper">
        <input type="text" name="" placeholder="Rechercher un produit" class="search__field" id="cloth_input">
        <button type="submit" class="search__icon"><span class="material-symbols-rounded">search</span></button>
    </div>
    <div class="settings__wrapper">
        <div class="note__wrapper">
            <span class="material-symbols-rounded star">star</span>
                <select name="note_selection" id="note_selections" class="note_selection">
                    <option value="descending">Notes décroissantes</option>
                    <option value="ascending">Notes croissantes</option>
                </select>
            <span class="material-symbols-rounded">expand_more</span>
        </div>
    </div>
</div>
<div id="mainContent">
    <div class="itemGlobal">
        <img src="./merch/assets/jogging.png">
        <p>Jogging</p>
        <div class="item_buy">
            <button>Ajouter au panier</button>
            <input type="number" value="1" class="item_nb" min="1">
        </div>
        <p class="prix">30 €</p>
        <div class="noteDiv" note="5">
        </div>
    </div>
    <div class="itemGlobal">
        <img src="./merch/assets/pullnormal.png">
        <p>Pull</p>
        <div class="item_buy">
            <button>Ajouter au panier</button>
            <input type="number" value="1" class="item_nb" min="1">
        </div>
        <p class="prix">30 €</p>
        <div class="noteDiv" note="4">
        </div>
    </div>
    <div class="itemGlobal">
        <img src="./merch/assets/pullmoche.png">
        <p>Pull d'été</p>
        <div class="item_buy">
            <button>Ajouter au panier</button>
            <input type="number" value="1" class="item_nb" min="1">
        </div>
        <p class="prix">30 €</p>
        <div class="noteDiv" note="4">
        </div>
    </div>
    <div class="itemGlobal">
        <img src="./merch/assets/portecle.png">
        <p>Porte clé</p>
        <div class="item_buy">
            <button>Ajouter au panier</button>
            <input type="number" value="1" class="item_nb" min="1">
        </div>
        <p class="prix">5 €</p>
        <div class="noteDiv" note="3">
        </div>
    </div>
    <div class="itemGlobal">
        <img src="./merch/assets/tshirtnoir.png">
        <p>T-shirt</p>
        <div class="item_buy">
            <button>Ajouter au panier</button>
            <input type="number" value="1" class="item_nb" min="1">
        </div>
        <p class="prix">20 €</p>
        <div class="noteDiv" note="3">
        </div>
    </div>
    <div class="itemGlobal">
        <img src="./merch/assets/Sans titre.png">
        <p>Sac de haute couture</p>
        <div class="item_buy">
            <button>Ajouter au panier</button>
            <input type="number" value="1" class="item_nb" min="1">
        </div>
        <p class="prix">500 €</p>
        <div class="noteDiv" note="1">
        </div>
    </div>
    <div class="itemGlobal">
        <img src="./merch/assets/conditions.png">
        <p>Conditions d'utilisation (made by Thomas Souchet ©)</p>
        <div class="item_buy">
            <button>Ajouter au panier</button>
            <input type="number" value="1" class="item_nb" min="1">
        </div>
        <p class="prix">15 €</p>
        <div class="noteDiv" note="5">
        </div>
    </div>
    <div class="itemGlobal">
        <img src="./merch/assets/boiteapizaa.png">
        <p>Boîte à pizza (made by Killian Arnaud)</p>
        <div class="item_buy">
            <button>Ajouter au panier</button>
            <input type="number" value="1" class="item_nb" min="1">
        </div>
        <p class="prix">1 €</p>
        <div class="noteDiv" note="4">
        </div>
    </div>
    <div class="itemGlobal">
        <img src="./merch/assets/sticker.png">
        <p>Stickers</p>
        <div class="item_buy">
            <button>Ajouter au panier</button>
            <input type="number" value="1" class="item_nb" min="1">
        </div>
        <p class="prix">3 €</p>
        <div class="noteDiv" note="3">
        </div>
    </div>
    <div class="itemGlobal">
        <img src="./merch/assets/cigarette.png">
        <p>Cigarettes</p>
        <div class="item_buy">
            <button>Ajouter au panier</button>
            <input type="number" value="1" class="item_nb" min="1">
        </div>
        <p class="prix">10 €</p>
        <div class="noteDiv" note="1">
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    const starPosition = 4

    for( let i = 0;i<$(".itemGlobal").length;i++){
        var current = $($(".itemGlobal")[i].children[starPosition])
        for(let x = 0;x<current.attr("note");x++){
            current.append('<span class="material-symbols-rounded">star</span>')
        }
    }

    $('#cloth_input').on("input",()=>{
        let regex = new RegExp("^(\w+)")
        for( let i = 0;i<$(".itemGlobal").length;i++){
            if(!($(".itemGlobal")[i].children[1].innerHTML.toLocaleLowerCase()).includes($('#cloth_input').val().toLocaleLowerCase())){
                $(".itemGlobal")[i].style.display = 'none'
            }else{
                $(".itemGlobal")[i].style.display = 'block'
            }
        }
    })

    function sortItems(array){
        for (let i = 0;i<array.length-1;i++){
            var current = $(array[i]).children()[starPosition]
            var note = $(current).attr("note")
            if($($(array[i+1]).children()[starPosition]).attr("note") < note){
                var temp = array[i+1].cloneNode(true)
                array[i+1] = array[i].cloneNode(true)
                array[i] = temp.cloneNode(true)
                return sortItems(array)
            }
        }
        return array
    }

    function moveChoiceTo(elem_choice) {

        var span = elem_choice,
            td = span.parentNode;
        var clone = span.cloneNode(true)

        td.insertBefore(clone, span.previousElementSibling);
        span.remove()
    }

    function getNote(element){
        return $($(element).children()[starPosition]).attr("note")
    }

    function reverseArray(array){
        for(let i = 1;i<=array.length/2;i++){
            let temp = array[array.length-i]
            array[array.length-i] = array[i-1]
            array[i-1] = temp
        }
        return array
    }

    $("#note_selections").on("change",()=>{
        var allItems = $(".itemGlobal")
        allItems = sortItems(allItems)
        console.log(allItems)
        var normalCollection = document.getElementById("note_selections");
        if(normalCollection.value == "descending"){
            allItems = reverseArray(allItems)
        }
        console.log(allItems)
        let modified = true
        while(modified){
            modified = false
            for(let i = 0;i<$(".itemGlobal").length && !modified;i++){
                if(getNote($(".itemGlobal")[i]) != getNote(allItems[i])){
                    var before = false
                    for(let x = 0;x<i && !before;x++){
                        if(getNote($(".itemGlobal")[i]) == getNote($(".itemGlobal")[x])){
                            before = true
                        }
                    }
                    if(!before){
                        moveChoiceTo($(".itemGlobal")[i],-1)
                        modified = true
                    }
                }
            }
        }
    })

    $("#note_selections").change()
</script>